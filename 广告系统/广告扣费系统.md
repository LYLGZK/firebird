# 一、扣费N问

## 1、如何抵御突增的高峰流量？

## 2、如何保证扣费消息不丢失？

## 3、如何保证其他依赖服务失败不影响扣费？

## 4、如何保证依赖的数据存储挂了不影响扣费？

## 5、如何制定反作弊系统？

## 6、如何定制有效的预警系统？

## 7、如何在扣费失败后进行补充扣费？

## 8、如何保证扣费幂等性？

## 9、如何保证扣费的快速准确？

## 10、消息堆积了如何处理？

## 11、如何高速的处理每一条扣费？

## 12、如何保证不会超过预算？

## 13、如何保证不会在账户没有余额的时候不再扣费？







# 二、现在sy的整体扣费消息量级

200w

| _c0    | hh   |
| ------ | ---- |
| 67244  | 0    |
| 77596  | 1    |
| 86210  | 2    |
| 59968  | 3    |
| 68247  | 4    |
| 66608  | 5    |
| 69496  | 6    |
| 73671  | 7    |
| 92516  | 8    |
| 119022 | 9    |
| 110901 | 10   |
| 78812  | 11   |
| 88088  | 12   |
| 99409  | 13   |
| 96311  | 14   |
| 103850 | 15   |
| 99861  | 16   |
| 90758  | 17   |
| 74984  | 18   |
| 88647  | 19   |
| 66584  | 20   |
| 72149  | 21   |
| 81982  | 22   |
| 78198  | 23   |

# 三、目标

1、扣费实时处理 ====》每一条扣费处理都做到最低耗时

2、扣费不漏扣

3、扣费不重复

4、扣费正确

5、







# 二、使用消息队列和流式计算的优劣

## 1、背景

* 使用kafka，如果因为代码问题或者网络等问题，导致一个consumer不可用了，当前



## 2、问题



## 3、解决方案

